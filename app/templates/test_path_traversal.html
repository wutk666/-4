<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>ç›®å½•éå†æµ‹è¯•é¶åœº</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    body { 
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .attack-card {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .attack-card h3 { color: #a8edea; margin-bottom: 16px; }
    .payload-example {
      background: #f8f9fa;
      border-left: 4px solid #a8edea;
      padding: 12px;
      border-radius: 4px;
      margin: 8px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payload-example:hover {
      background: #e9ecef;
      transform: translateX(4px);
    }
    .result-box {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      max-height: 400px;
      overflow-y: auto;
    }
    .result-box.blocked {
      border-left: 4px solid #ffc107;
      background: #fff8e1;
    }
    .result-box.success {
      border-left: 4px solid #28a745;
      background: #f0fff4;
    }
    .file-content {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .file-list {
      list-style: none;
      padding: 0;
    }
    .file-list li {
      padding: 8px 12px;
      border-bottom: 1px solid #dee2e6;
      cursor: pointer;
      transition: background 0.2s;
    }
    .file-list li:hover {
      background: #f8f9fa;
    }
    .file-list .bi {
      margin-right: 8px;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="container" style="max-width: 1400px;">
    <div class="text-center mb-4">
      <h1 class="text-white mb-2"><i class="bi bi-folder2-open"></i> ç›®å½•éå†æµ‹è¯•é¶åœº</h1>
      <p class="text-white-50">æµ‹è¯•è·¯å¾„éå†æ”»å‡»åŠè®¿é—®æ§åˆ¶é˜²å¾¡</p>
      <span class="badge bg-warning text-dark">ğŸš« è®¿é—®æ§åˆ¶æ”»å‡»</span>
      <span class="badge bg-danger">ä¸¥é‡ç¨‹åº¦: HIGH</span>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="attack-card">
          <h3><i class="bi bi-file-earmark-text"></i> æ–‡ä»¶æŸ¥çœ‹å™¨</h3>
          <p class="small text-muted">æ¨¡æ‹Ÿæ–‡ä»¶ä¸‹è½½åŠŸèƒ½ï¼Œæµ‹è¯•ç›®å½•éå†æ¼æ´</p>
          
          <div class="mb-3">
            <label class="form-label small">æ–‡ä»¶è·¯å¾„</label>
            <input type="text" id="fileInput" class="form-control" placeholder="ä¾‹å¦‚: documents/readme.txt">
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label small">æ¨¡æ‹ŸIPåœ°å€</label>
              <input type="text" id="simulatedIp" class="form-control form-control-sm" placeholder="ç•™ç©ºä½¿ç”¨çœŸå®IP">
              <small class="text-muted">ä¾‹: 172.16.0.100</small>
            </div>
            <div class="col-md-6">
              <label class="form-label small">é˜²å¾¡å¼€å…³</label>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="defenseSwitch" checked>
                <label class="form-check-label small" for="defenseSwitch">
                  <span id="defenseSwitchLabel">é˜²å¾¡å·²å¼€å¯</span>
                </label>
              </div>
              <small class="text-muted">å…³é—­åå¯æŸ¥çœ‹æ”»å‡»æ•ˆæœ</small>
            </div>
          </div>
          
          <button id="viewBtn" class="btn btn-primary btn-sm w-100 mb-3">
            <i class="bi bi-eye"></i> æŸ¥çœ‹æ–‡ä»¶
          </button>
          
          <div class="mb-3">
            <strong class="small">å¸¸è§è·¯å¾„éå† Payload:</strong>
            <div class="payload-example" data-payload="../../../etc/passwd">
              <strong>Linuxå¯†ç æ–‡ä»¶:</strong> ../../../etc/passwd
            </div>
            <div class="payload-example" data-payload="../../etc/shadow">
              <strong>Linuxå½±å­æ–‡ä»¶:</strong> ../../etc/shadow
            </div>
            <div class="payload-example" data-payload="../../../windows/system32/config/sam">
              <strong>Windows SAM:</strong> ../../../windows/system32/config/sam
            </div>
            <div class="payload-example" data-payload="....//....//....//etc/passwd">
              <strong>åŒé‡ç¼–ç :</strong> ....//....//....//etc/passwd
            </div>
            <div class="payload-example" data-payload="%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd">
              <strong>URLç¼–ç :</strong> %2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd
            </div>
            <div class="payload-example" data-payload="..%2f..%2f..%2fetc%2fpasswd">
              <strong>æ··åˆç¼–ç :</strong> ..%2f..%2f..%2fetc%2fpasswd
            </div>
            <div class="payload-example" data-payload="/var/log/apache2/access.log">
              <strong>æ—¥å¿—æ–‡ä»¶:</strong> /var/log/apache2/access.log
            </div>
          </div>
          
          <div id="fileResult" class="result-box" style="display:none;"></div>
        </div>

        <div class="attack-card">
          <h3><i class="bi bi-folder"></i> å…è®¸è®¿é—®çš„æ–‡ä»¶</h3>
          <p class="small text-muted">ç‚¹å‡»æ–‡ä»¶åå¿«é€Ÿå¡«å……</p>
          <ul class="file-list">
            <li data-file="documents/readme.txt">
              <i class="bi bi-file-text"></i> documents/readme.txt
            </li>
            <li data-file="documents/guide.pdf">
              <i class="bi bi-file-pdf"></i> documents/guide.pdf
            </li>
            <li data-file="images/logo.png">
              <i class="bi bi-file-image"></i> images/logo.png
            </li>
            <li data-file="public/index.html">
              <i class="bi bi-file-code"></i> public/index.html
            </li>
          </ul>
        </div>
      </div>

      <div class="col-md-6">
        <div class="attack-card">
          <h3><i class="bi bi-shield-check"></i> é˜²å¾¡çŠ¶æ€ç›‘æ§</h3>
          <p class="small text-muted">å®æ—¶æ˜¾ç¤ºè·¯å¾„éå†æ£€æµ‹å’Œæ‹¦æˆªæƒ…å†µ</p>
          
          <div id="defenseStatus" class="alert alert-info">
            <strong>é˜²å¾¡ç³»ç»Ÿ:</strong> <span id="defenseState">ç­‰å¾…æµ‹è¯•...</span>
          </div>
          
          <div class="mb-3">
            <strong class="small">æ”»å‡»æ£€æµ‹è¯¦æƒ…:</strong>
            <div id="attackDetails" class="mt-2" style="font-size: 13px;">
              <p class="text-muted">æš‚æ— æ£€æµ‹è®°å½•</p>
            </div>
          </div>
          
          <div class="mb-3">
            <strong class="small">è·¯å¾„éå†æ”»å‡»ç±»å‹:</strong>
            <ul class="small mt-2">
              <li><strong>ç›¸å¯¹è·¯å¾„éå†:</strong> ../ æˆ– ..\</li>
              <li><strong>ç»å¯¹è·¯å¾„è®¿é—®:</strong> /etc/passwd</li>
              <li><strong>URLç¼–ç ç»•è¿‡:</strong> %2e%2e%2f</li>
              <li><strong>åŒé‡ç¼–ç :</strong> %252e%252e%252f</li>
              <li><strong>æ··åˆç¼–ç :</strong> ..%2f</li>
              <li><strong>Unicodeç¼–ç :</strong> ..%c0%af</li>
            </ul>
          </div>
        </div>

        <div class="attack-card">
          <h3><i class="bi bi-exclamation-triangle"></i> æ•æ„Ÿæ–‡ä»¶åˆ—è¡¨</h3>
          <div style="font-size: 13px;">
            <strong>Linux:</strong>
            <ul class="small">
              <li>/etc/passwd - ç”¨æˆ·è´¦æˆ·ä¿¡æ¯</li>
              <li>/etc/shadow - åŠ å¯†å¯†ç </li>
              <li>/etc/hosts - ä¸»æœºæ˜ å°„</li>
              <li>/var/log/* - ç³»ç»Ÿæ—¥å¿—</li>
              <li>~/.ssh/id_rsa - SSHç§é’¥</li>
            </ul>
            <strong>Windows:</strong>
            <ul class="small">
              <li>C:\Windows\System32\config\SAM</li>
              <li>C:\boot.ini</li>
              <li>C:\Windows\win.ini</li>
              <li>C:\inetpub\wwwroot\web.config</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <a href="{{ url_for('attack_hub') }}" class="btn btn-outline-light btn-sm me-2">è¿”å›æ”»å‡»ä¸­å¿ƒ</a>
      <a href="{{ url_for('console') }}" class="btn btn-outline-light btn-sm">æ§åˆ¶å°</a>
    </div>
  </div>

  <script>
    document.querySelectorAll('.payload-example').forEach(el => {
      el.addEventListener('click', () => {
        document.getElementById('fileInput').value = el.dataset.payload;
      });
    });

    document.getElementById('defenseSwitch').addEventListener('change', (e) => {
      const label = document.getElementById('defenseSwitchLabel');
      if (e.target.checked) {
        label.textContent = 'é˜²å¾¡å·²å¼€å¯';
        label.classList.remove('text-danger');
        label.classList.add('text-success');
      } else {
        label.textContent = 'é˜²å¾¡å·²å…³é—­';
        label.classList.remove('text-success');
        label.classList.add('text-danger');
      }
    });

    document.querySelectorAll('.file-list li').forEach(el => {
      el.addEventListener('click', () => {
        document.getElementById('fileInput').value = el.dataset.file;
      });
    });

    document.getElementById('viewBtn').addEventListener('click', async () => {
      const filepath = document.getElementById('fileInput').value;
      const defenseEnabled = document.getElementById('defenseSwitch').checked;
      const simulatedIp = document.getElementById('simulatedIp').value.trim();
      const resultEl = document.getElementById('fileResult');
      const statusEl = document.getElementById('defenseStatus');
      const detailsEl = document.getElementById('attackDetails');
      const stateEl = document.getElementById('defenseState');
      
      if (!filepath) {
        alert('è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„');
        return;
      }
      
      resultEl.style.display = 'block';
      resultEl.className = 'result-box';
      resultEl.innerHTML = '<div class="text-center"><div class="spinner-border spinner-border-sm"></div> è¯»å–ä¸­...</div>';
      
      try {
        const r = await fetch('/attack/path/view', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            filepath: filepath,
            defense_enabled: defenseEnabled,
            simulated_ip: simulatedIp
          })
        });
        
        const data = await r.json();
        
        if (data.blocked) {
          resultEl.className = 'result-box blocked';
          statusEl.className = 'alert alert-warning';
          stateEl.innerHTML = '<i class="bi bi-shield-fill-exclamation"></i> æ”»å‡»å·²æ‹¦æˆª';
          
          detailsEl.innerHTML = `
            <div class="alert alert-warning mb-2">
              <strong>æ£€æµ‹åˆ°æ”»å‡»:</strong> ${data.attack_type || 'ç›®å½•éå†'}
            </div>
            <div><strong>æ”»å‡»æè¿°:</strong> ${data.description || 'æœªçŸ¥'}</div>
            <div><strong>ä¸¥é‡ç¨‹åº¦:</strong> <span class="badge bg-danger">${data.severity || 'HIGH'}</span></div>
            <div><strong>æ”»å‡»åˆ†ç±»:</strong> <span class="badge bg-warning">${data.category || 'è®¿é—®æ§åˆ¶æ”»å‡»'}</span></div>
          `;
          
          resultEl.innerHTML = `
            <div class="alert alert-warning">
              <i class="bi bi-shield-exclamation"></i> <strong>ç›®å½•éå†æ”»å‡»å·²è¢«æ‹¦æˆªï¼</strong>
            </div>
            <p><strong>æ£€æµ‹åˆ°çš„æ”»å‡»æ¨¡å¼:</strong> ${data.description}</p>
            <p class="text-muted small">éæ³•è·¯å¾„è®¿é—®å·²è¢«é˜»æ­¢ï¼Œæ•æ„Ÿæ–‡ä»¶å—åˆ°ä¿æŠ¤ã€‚</p>
          `;
        } else if (data.error) {
          resultEl.className = 'result-box error';
          resultEl.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
        } else {
          resultEl.className = 'result-box success';
          statusEl.className = 'alert alert-success';
          stateEl.innerHTML = '<i class="bi bi-check-circle"></i> æ–‡ä»¶è¯»å–æˆåŠŸ';
          
          let statusInfo = '';
          if (!data.defense_enabled) {
            statusInfo = '<div class="alert alert-danger mb-2"><i class="bi bi-shield-slash"></i> <strong>é˜²å¾¡å·²å…³é—­</strong> - è·¯å¾„æœªè¢«æ‹¦æˆªï¼ˆé¶åœºç¯å¢ƒï¼‰</div>';
            detailsEl.innerHTML = '<p class="text-warning">âš ï¸ é˜²å¾¡å…³é—­ï¼Œæ–‡ä»¶è®¿é—®æœªè¢«é™åˆ¶ï¼ˆä»…åœ¨é¶åœºå†…ï¼‰</p>';
          } else {
            detailsEl.innerHTML = '<p class="text-success">âœ“ æœªæ£€æµ‹åˆ°ç›®å½•éå†</p>';
          }
          
          if (data.simulated_ip) {
            statusInfo += `<div class="alert alert-info mb-2"><i class="bi bi-router"></i> æ¨¡æ‹ŸIP: <strong>${data.simulated_ip}</strong></div>`;
          }
          
          resultEl.innerHTML = statusInfo + `
            <div class="alert alert-success mb-2">æ–‡ä»¶: ${data.filename}</div>
            <pre style="background: #f8f9fa; padding: 12px; border-radius: 4px; font-size: 12px; max-height: 300px; overflow-y: auto;">${data.content}</pre>
          `;
        }
      } catch(e) {
        resultEl.className = 'result-box error';
        resultEl.innerHTML = `<div class="alert alert-danger">è¯·æ±‚å¤±è´¥: ${e.message}</div>`;
      }
    });
  </script>
</body>
</html>
