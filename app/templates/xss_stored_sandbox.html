<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>存储型 XSS 靶场</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { 
      margin: 0; 
      padding: 20px; 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f8f9fa;
    }
    .sandbox-header {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 20px;
    }
    .sandbox-header h3 {
      margin: 0 0 8px 0;
      color: #856404;
      font-size: 16px;
    }
    .sandbox-header p {
      margin: 0;
      font-size: 13px;
      color: #856404;
    }
    .comment-list {
      background: white;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .comment-item {
      border-bottom: 1px solid #e9ecef;
      padding: 12px 0;
    }
    .comment-item:last-child {
      border-bottom: none;
    }
    .comment-author {
      font-weight: 600;
      color: #495057;
      margin-bottom: 4px;
    }
    .comment-time {
      font-size: 12px;
      color: #6c757d;
      margin-left: 8px;
    }
    .comment-content {
      margin-top: 8px;
      color: #212529;
      line-height: 1.5;
    }
    .no-comments {
      text-align: center;
      color: #6c757d;
      padding: 40px;
    }
  </style>
</head>
<body>
  <div class="sandbox-header">
    <h3>存储型 XSS 靶场 - 隔离展示区域</h3>
    <p>此区域用于展示存储在数据库中的评论内容。如果防御失败，恶意脚本将在此隔离环境中执行，不会影响主页面。</p>
  </div>

  <div class="comment-list" id="commentList">
    <div class="no-comments">加载中...</div>
  </div>

  <script>
    async function loadComments() {
      try {
        const r = await fetch('/xss/stored');
        const data = await r.json();
        const container = document.getElementById('commentList');
        
        if (!data.comments || data.comments.length === 0) {
          container.innerHTML = '<div class="no-comments">暂无评论</div>';
          return;
        }
        
        // 注意：这里故意使用 innerHTML 直接插入，以演示存储型 XSS
        // 如果防御失败，恶意脚本会在这里执行
        container.innerHTML = data.comments.map(c => `
          <div class="comment-item">
            <div class="comment-author">
              ${c.author}
              <span class="comment-time">${new Date(c.timestamp).toLocaleString()}</span>
            </div>
            <div class="comment-content">${c.content}</div>
          </div>
        `).join('');
      } catch(e) {
        document.getElementById('commentList').innerHTML = 
          '<div class="no-comments" style="color: #dc3545;">加载失败: ' + e.message + '</div>';
      }
    }

    loadComments();
    
    // 每5秒自动刷新
    setInterval(loadComments, 5000);
  </script>
</body>
</html>
